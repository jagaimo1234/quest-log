# クエスト ログ - 要求仕様に基づく再実装

## 実装完了状況

**全46件のvitestテストが合格**

## 設計思想（最重要）

> 「自己管理ではなく、クエストの記録」

- クエストは完了させるためだけのものではない
- 行動・判断・継続状態そのものを記録する
- 義務感・自己否定を生まない設計を最優先

## 要求仕様チェックリスト

### 1. 目的・背景
- [x] 義務感なく主体性を保ったまま継続できる形
- [x] 時刻固定ではなく「いつやるかは自由、期限だけが存在する」クエスト形式
- [x] Duolingo × Monster Hunter参考
- [x] 自己管理を「評価」ではなく「記録」として扱う

### 2. アプリ形態・前提
- [x] Webアプリとして実装
- [x] 個人利用を想定
- [x] ログイン必須ではない（将来拡張可）
- [x] データはユーザー単位で保持

### 3. 基本概念
#### 3.1 クエスト（Quest）
- [x] タスク・習慣・予定・雑務をすべて「クエスト」として扱う
- [x] 完了・未完了・中断・キャンセルを含むライフサイクル

#### 3.2 クエスト種別（頻度）
- [x] Daily（毎日）
- [x] Weekly（週1）
- [x] Monthly（月1）
- [x] Yearly（年1）
- [x] Free（単発・イレギュラー）

### 4. クエスト登録仕様
#### 4.1 入力項目（すべて最小限・任意中心）
- [x] クエスト名（任意）→ 何をするか
- [x] 案件名（任意）→ 何についてのクエストか
- [x] クエスト種別（Daily/Weekly/Monthly/Yearly/Free）
- [x] 難易度（★〜★★★）
- [x] クエスト名・案件名が空でも登録可能
- [x] 入力必須はクエスト種別のみ

### 5. クエストライフサイクル
- [x] unreceived（未受注）
- [x] accepted（受注中）
- [x] challenging（チャレンジ中）
- [x] almost（もう少し）
- [x] cleared（クリア）
- [x] paused（中断）
- [x] cancelled（キャンセル）

### 6. 期限仕様
- [x] 期限は任意（設定しなくても良い）
- [x] 登録時・受注時・進行中いつでも変更可能
- [x] 期限を超えても「失敗」ではない（継続中として表示）
- [x] Daily: 当日中（23:59:59）
- [x] Weekly: 週末（日曜23:59:59）
- [x] Monthly: 月末（23:59:59）
- [x] Yearly: 年末（12/31 23:59:59）
- [x] Free: 期限なし

### 7. テンプレート機能
- [x] Daily: 毎日、日付変更時に自動生成
- [x] Weekly: 指定曜日に自動生成
- [x] Monthly: 指定週（第1週〜第4週/月末週）に自動生成
- [x] Yearly: 指定月の指定週に自動生成
- [x] テンプレートの有効/無効切り替え

### 8. クエスト受注
- [x] unreceived → accepted への遷移
- [x] 受注中一覧に表示
- [x] 再受注可能

### 9. クエスト進行
- [x] accepted → challenging への遷移
- [x] challenging → almost への遷移
- [x] 進行状況の可視化

### 10. クエスト完了
- [x] almost → cleared への遷移
- [x] クリア時刻の記録
- [x] XP獲得
- [x] 達成演出

### 11. クエスト中断
- [x] paused ステータスへの遷移
- [x] 受注中一覧から除外
- [x] 再受注可能
- [x] 履歴に残す

### 12. クエストキャンセル
- [x] cancelled ステータスへの遷移
- [x] 受注中一覧から除外
- [x] 再受注は新規扱い
- [x] 履歴に残す

### 13. 履歴機能（曜日別）
- [x] 日付＋曜日ごとの表示
- [x] クリア、中断、キャンセル、未完了の表示
- [x] 表示例: 12/25（水）✔ 今週の振り返り（Weekly｜MOAI活動）
- [x] 評価・点数なし（事実ログのみ）

### 14. 継続要素（簡易）
- [x] クリア時のみXP・報酬付与
- [x] 連続ログイン（ストリーク）
- [x] 1日1クエスト以上クリアで継続
- [x] 中断・キャンセルのみの日は継続扱いしないが減点もしない

### 15. UIデザイン方針（必須）
- [x] モンスターハンターのクエストUIのような世界観
- [x] 重厚感・貫禄・歴史を感じるデザイン
- [x] フラットデザイン禁止
- [x] 石・革・金属・木の質感
- [x] 角ばったフレーム
- [x] 太めの文字
- [x] ダークトーン中心
- [x] 「クエスト掲示板」「冒険者の記録帳」のイメージ

### 16. モアイ機能
- [x] 各クエストにランダムなモアイを割り当て
- [x] 8種類のモアイタイプ
- [x] ステータス連動の視覚変化:
  - unreceived: 薄い（dim）
  - accepted: 通常
  - challenging: 強調
  - almost: グロー
  - cleared: 勝利アニメーション

### 17. クエストクリア演出
- [x] 画面中央に「クエスト クリア」メッセージ
- [x] モアイのアニメーション
- [x] XP獲得表示

## 実装フェーズ

### Phase 1: データベーススキーマ ✅
- [x] quests テーブル
- [x] quest_templates テーブル
- [x] quest_history テーブル
- [x] user_progression テーブル

### Phase 2: UIデザインシステム ✅
- [x] Monster Hunter風カラーパレット（茶色系、地図風）
- [x] 角ばったフレームコンポーネント
- [x] 太めのフォント設定
- [x] 石・革・金属のテクスチャ

### Phase 3: コア機能 ✅
- [x] クエスト登録（最小限入力）
- [x] クエスト受注
- [x] ステータス遷移
- [x] 期限管理

### Phase 4: テンプレート機能 ✅
- [x] テンプレート登録
- [x] 自動生成ロジック
- [x] 有効/無効切り替え

### Phase 5: 履歴機能 ✅
- [x] 曜日別表示
- [x] ステータスアイコン
- [x] 事実ログのみ

### Phase 6: 継続要素 ✅
- [x] XPシステム
- [x] ストリーク計算
- [x] クリア演出

### Phase 7: 日本語化 ✅
- [x] 全UI日本語化
- [x] 曜日・月名の日本語対応



## ユーザー要求（実装完了）

### 要求: 開始日と期限の明示的指定
- [x] データベーススキーマに startDate カラムを追加
- [x] tRPC プロシージャーに startDate パラメータを追加
- [x] クエスト作成フォームに開始日と期限の入力フィールドを追加
- [x] 開始日と期限機能の統合テストを実装
- [x] 全テストが合格 (60件)

## ユーザーフィードバック（修正完了）

### 問題1: 新規クエストボタンが機能しない
- [x] 「新規クエスト」ボタンをクリックしてもクエスト作成ダイアログが表示されない
- [x] クエスト作成画面が表示されるように修正


## ユーザー要求（実装中）

### 要求: 開始日と期限の明示的入力
- [ ] クエスト作成時に開始日を入力可能に
- [ ] クエスト作成時に期限を入力可能に
- [ ] クエスト種別は期間の「ざっくりとした区分」として機能
- [ ] 例：金曜日のためのクエスト、来週のための1週間期限クエスト
- [ ] データベーススキーマを更新
- [ ] tRPCプロシージャーを更新
- [ ] フロントエンドフォームを更新
- [ ] テストを実装


## ユーザー要求（実装完了）

### 要求: スマートフォンでのクエスト登録画面の最適化
- [x] ダイアログの位置を画面中孤に調整
- [x] スマートフォン表示時にダイアログを上部に配置
- [x] ダイアログ内のフォーム要素をスクロール可能に
- [x] ボタンのサイズをタップしやすいサイズに調整
- [x] モバイル表示でのレイアウト最適化


## ユーザー要求（実装完了）

### 要求: Monster Hunter風UIデザインの強化
- [x] カードの立体感強化（box-shadow、グラデーション）
- [x] 受注ボタンのデザイン改善（青い光沢、立体的）
- [x] 装飾的な枠線の追加
- [x] テクスチャ背景の強化
- [x] 受注中クエストエリアのスクロール風デザイン
- [x] 難易度星の装飾強化

## ユーザー要求（実装完了）

### 要求: ログイン画面の廃止
- [x] ログイン画面を削除
- [x] アプリケーション起動時にゲストモードで自動的にダッシュボードを表示
- [x] ゲストモード認証フローの確認
